<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Раскрой свой КРИСТАЛЛ ДУШИ</title>
<style>
  :root{
    --bg:#0f1220; --panel:#141a2a; --ink:#eaf2ff; --muted:#a9b6d3;
    --accent:#63a4ff; --radius:18px; --gap:14px; --shadow:0 10px 40px rgba(0,0,0,.35);
    --red:#ff6b6b; --blue:#5ab0ff; --green:#33d9a6; --chip:#273149;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;
    color:var(--ink);
    background: radial-gradient(1200px 800px at 70% -10%, #1b2250 0%, transparent 60%), linear-gradient(#0e1120,#0f1220 40%);
    min-height:100dvh;
  }
  .wrap{max-width:980px;margin:auto;padding:24px 18px 64px}
  header{text-align:center;margin:12px 0 18px}
  h1{margin:0;font-weight:800;line-height:1.15;letter-spacing:.5px;font-size:clamp(28px,4.6vw,44px)}
  .glow{color:#fff4cc;text-shadow:0 0 18px rgba(255,215,106,.55),0 0 38px rgba(255,215,106,.35)}

  .panel{background:var(--panel);border-radius:var(--radius);padding:16px;margin-bottom:16px;box-shadow:var(--shadow)}
  label{display:block;font-size:14px;color:var(--muted);margin:0 0 6px 2px}
  .row{display:flex;flex-wrap:wrap;gap:var(--gap)}
  .flex{flex:1 1 280px}
  input[type="date"],select{
    width:100%;height:54px;padding:0 14px;border-radius:12px;border:0;outline:0;background:#1a2236;color:var(--ink);font-size:16px;
  }
  button{
    width:100%;height:54px;padding:0 16px;border-radius:12px;border:0;outline:0;font-weight:800;letter-spacing:.2px;cursor:pointer;
    transition:.2s transform,.2s filter,.2s box-shadow;
  }
  button.primary{color:#fff;background:linear-gradient(180deg,#4f86ff,#2a66ff);box-shadow:0 10px 28px rgba(42,102,255,.35)}
  button.primary:hover{filter:brightness(1.05)}
  button.ghost{color:#cfe0ff;background:#1a2236;box-shadow:0 8px 18px rgba(0,0,0,.25) inset}

  .vy{margin:18px 4px 10px;font-size:22px;font-weight:800}

  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:18px}
  .cell{
    border-radius:16px;height:108px;display:flex;align-items:center;justify-content:center;
    font-size:40px;font-weight:800;color:#0d1220;box-shadow:inset 0 0 0 2px rgba(0,0,0,.12);
    text-shadow:0 1px 1px rgba(255,255,255,.35)
  }
  .c1{background:#ff6b6b}.c2{background:#ff9f4f}.c3{background:#ffd166}
  .c4{background:#b6ff66}.c5{background:#1ea34a;color:#eafff5}
  .c6{background:#86e1e9}.c7{background:#4f7cff;color:#eef4ff}
  .c8{background:#c3e3ff}.c9{background:#b184ff}.c10{background:#d49efc}
  .c11{background:#ff76b5}.c12{background:#f9c6d5}

  .acc{background:#141a2a;border-radius:18px;padding:16px;margin-bottom:14px;box-shadow:var(--shadow)}
  .accHead{display:flex;align-items:center;justify-content:space-between;gap:10px;cursor:pointer}
  .accTitle{font-weight:900;letter-spacing:.3px}
  .accTitle.red{color:var(--red)} .accTitle.blue{color:var(--blue)} .accTitle.green{color:var(--green)}
  .chip{background:var(--chip);color:#cfe0ff;padding:8px 12px;border-radius:999px;font-weight:700}
  .accBody{display:none;padding-top:10px;color:#e9f0ff;line-height:1.6}
  .acc.open .accBody{display:block}
  .hint{color:var(--muted);text-align:center;margin:12px 0 0}

  @media (min-width:720px){ .grid{gap:16px}.cell{height:120px;font-size:42px} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>
      <span id="titleStart">Раскрой свой</span><br/>
      <span class="glow" id="titleGlow">КРИСТАЛЛ ДУШИ</span>
    </h1>
  </header>

  <section class="panel">
    <div class="row">
      <div class="flex">
        <label id="dobLabel">Дата рождения</label>
        <input id="dob" type="date" />
      </div>
      <div class="flex">
        <label id="langLabel">Язык</label>
        <select id="lang">
          <option value="auto">Auto</option>
          <option value="ru">Русский</option>
          <option value="en">English</option>
        </select>
      </div>
      <div class="flex" style="align-self:end">
        <button id="calcBtn" class="primary">Рассчитать</button>
      </div>
      <div class="flex" style="align-self:end">
        <button id="pdfBtn" class="ghost">Скачать PDF</button>
      </div>
    </div>
  </section>

  <div id="vy" class="vy"></div>
  <section id="grid" class="grid" aria-live="polite"></section>

  <section class="panel">
    <h2 id="instrTitle" style="margin:4px 6px 12px;text-align:center">Инструкция к кодам</h2>

    <div class="acc" id="acc1">
      <div class="accHead">
        <div class="accTitle red" id="t1">1) АКТИВАЦИЯ КРИСТАЛЛА ДУШИ</div>
        <div class="chip"><span id="n1">–</span> / <span id="n2">–</span> / <span id="n3">–</span></div>
      </div>
      <div class="accBody" id="acc1b"></div>
    </div>

    <div class="acc" id="acc2">
      <div class="accHead">
        <div class="accTitle blue" id="t2">2) ЗАПУСК ТОРСИОННОГО ПОЛЯ</div>
        <div class="chip">T1 / T2 / T3</div>
      </div>
      <div class="accBody" id="acc2b"></div>
    </div>

    <div class="acc" id="acc3">
      <div class="accHead">
        <div class="accTitle green" id="t3">3) ИНТЕГРАЦИЯ ТЕЛА СВЕТА</div>
        <div class="chip">C1 / C2 / C3</div>
      </div>
      <div class="accBody" id="acc3b"></div>
    </div>

    <p class="hint" id="pdfHint">PDF включу после финальной проверки текстов.</p>
  </section>
</div>

<!-- pdf libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" referrerpolicy="no-referrer"></script>

<script>
/* ===== i18n: полный текст с подстановками чисел ===== */
const I18N = {
  ru: {
    titleStart:"Раскрой свой",
    titleGlow:"КРИСТАЛЛ ДУШИ",
    dobLabel:"Дата рождения",
    langLabel:"Язык",
    calc:"Рассчитать",
    pdf:"Скачать PDF",
    instrTitle:"Инструкция к кодам",
    t1:"1) АКТИВАЦИЯ КРИСТАЛЛА ДУШИ",
    t2:"2) ЗАПУСК ТОРСИОННОГО ПОЛЯ",
    t3:"3) ИНТЕГРАЦИЯ ТЕЛА СВЕТА",
    pdfHint:"PDF включу после финальной проверки текстов.",
    vy:"Уровень Высшего Я: ",
    a1:(N1,N2,N3)=>`
      <p><b>Дыхание с фокусом на Высшем сердце (Тимус).</b> Сложи ладони в «намасте» на уровне груди и сделай вдох из шишковидной железы (аджна), опуская серебристую энергию в точку Высшего сердца. Затем разведи руки перпендикулярно телу на уровне груди и выдохни золотую энергию из Тимуса в мир.</p>
      <p><b>Мысленная формула:</b> «ВДЫХАЮ СВЕТ — ВЫДЫХАЮ ЛЮБОВЬ!». Представляй, как с каждым выдохом вокруг тебя образуется защитное облако золотого света. <br><b>Сделай:</b> <b>N1 = ${N1}</b> раз.</p>
      <p>Далее — со сложенными на груди руками: на вдохе втягивай поток огненной энергии из солнечного сплетения (нижняя сердечная чакра) к Тимусу, а затем на расправленных руках выдыхай в мир золотую энергию.</p>
      <p><b>Мысленная формула:</b> «ВДЫХАЮ СИЛУ — ВЫДЫХАЮ ВОЛЮ!». Также визуализируй золотое защитное облако. <br><b>Сделай:</b> <b>N2 = ${N2}</b> раз.</p>
      <p>Представь в груди светящийся Кристалл — портал между телом и твоей светоносной копией. Затем простучи точку Тимуса, протяжно звуча «аа». <br><b>Сделай простукивание:</b> <b>N3 = ${N3}</b> раз.</p>
    `,
    a2:(T1,T2,T3)=>`
      <p><b>Верхняя воронка:</b> <i>вращение вокруг своей оси</i> по часовой стрелке, руки подняты вверх. <br><b>Сделай:</b> <b>T1 = ${T1}</b> раз.</p>
      <p><b>Нижняя воронка:</b> <i>вращение вокруг своей оси</i> против часовой стрелки, руки опущены вниз. <br><b>Сделай:</b> <b>T2 = ${T2}</b> раз.</p>
      <p><b>Гармонизация потоков земной и небесной энергий:</b> сложи руки на груди в намасте и выполняй <b>прыжки</b> (или быстрые перекаты с пятки на носок). <br><b>Сделай:</b> <b>T3 = ${T3}</b> раз.</p>
    `,
    a3:(C1,C2,C3)=>`
      <p><b>Одновременные круги руками вперёд</b> — обе руки движутся синхронно. <br><b>Сделай:</b> <b>C1 = ${C1}</b> раз.</p>
      <p><b>Одновременные круги руками назад</b> — обе руки движутся синхронно. <br><b>Сделай:</b> <b>C2 = ${C2}</b> раз.</p>
      <p><b>Фиксация потоков:</b> соедини ладони в намасте на груди и выполни мягкое <b>надавливание ладонями</b> друг на друга. <br><b>Сделай:</b> <b>C3 = ${C3}</b> раз.</p>
    `
  },
  en: {
    titleStart:"Reveal your",
    titleGlow:"SOUL CRYSTAL",
    dobLabel:"Date of birth",
    langLabel:"Language",
    calc:"Calculate",
    pdf:"Download PDF",
    instrTitle:"Instructions",
    t1:"1) SOUL CRYSTAL ACTIVATION",
    t2:"2) TORSION FIELD LAUNCH",
    t3:"3) LIGHT BODY INTEGRATION",
    pdfHint:"PDF will be enabled after the final text review.",
    vy:"Higher Self Level: ",
    a1:(N1,N2,N3)=>`
      <p><b>Breathing with focus on the Higher Heart (thymus).</b> Palms in namaste at the chest; inhale from the pineal (ajna) guiding silvery energy into the Higher Heart point. Then open your arms at chest level and exhale golden energy from the thymus into the world.</p>
      <p><b>Mental formula:</b> “I BREATHE IN LIGHT — I BREATHE OUT LOVE!”. Visualize a protective golden cloud forming around you with each exhale. <br><b>Do:</b> <b>N1 = ${N1}</b> times.</p>
      <p>Next, with palms folded at the chest: inhale a fiery flow from the solar plexus (lower heart chakra) to the thymus, then exhale golden light with arms open.</p>
      <p><b>Mental formula:</b> “I BREATHE IN POWER — I BREATHE OUT WILL!”. Keep visualizing the golden protective cloud. <br><b>Do:</b> <b>N2 = ${N2}</b> times.</p>
      <p>Imagine a luminous Crystal inside your chest — a portal between the body and your light copy. Then tap the thymus while sounding “aa”. <br><b>Do tapping:</b> <b>N3 = ${N3}</b> times.</p>
    `,
    a2:(T1,T2,T3)=>`
      <p><b>Upper vortex:</b> <i>rotation around your own axis</i> clockwise, hands up. <br><b>Do:</b> <b>T1 = ${T1}</b> times.</p>
      <p><b>Lower vortex:</b> <i>rotation around your own axis</i> counter-clockwise, hands down. <br><b>Do:</b> <b>T2 = ${T2}</b> times.</p>
      <p><b>Harmonization of earth and heaven flows:</b> palms in namaste on the chest and make light <b>jumps</b> (or quick heel-to-toe rolls). <br><b>Do:</b> <b>T3 = ${T3}</b> times.</p>
    `,
    a3:(C1,C2,C3)=>`
      <p><b>Both arms circles forward</b> — simultaneously. <br><b>Do:</b> <b>C1 = ${C1}</b> times.</p>
      <p><b>Both arms circles backward</b> — simultaneously. <br><b>Do:</b> <b>C2 = ${C2}</b> times.</p>
      <p><b>Fixation:</b> palms in namaste at the chest, gentle <b>pressing of the palms</b> against each other. <br><b>Do:</b> <b>C3 = ${C3}</b> times.</p>
    `
  }
};

const $ = s=>document.querySelector(s);

/* ===== язык ===== */
function detectLang(){
  const sel = $('#lang').value;
  if(sel!=='auto') return sel;
  return (navigator.language||'en').toLowerCase().startsWith('ru') ? 'ru' : 'en';
}
function applyLang(){
  const L = detectLang(), t = I18N[L];
  $('#titleStart').textContent = t.titleStart;
  $('#titleGlow').textContent  = t.titleGlow;
  $('#dobLabel').textContent   = t.dobLabel;
  $('#langLabel').textContent  = t.langLabel;
  $('#calcBtn').textContent    = t.calc;
  $('#pdfBtn').textContent     = t.pdf;
  $('#instrTitle').textContent = t.instrTitle;
  $('#t1').textContent         = t.t1;
  $('#t2').textContent         = t.t2;
  $('#t3').textContent         = t.t3;
  $('#pdfHint').textContent    = t.pdfHint;
  if(window._lastISO){ renderAll(window._lastISO); }
}

/* ===== математика ===== */
const sumDigits = n => String(Math.abs(n)).split('').reduce((a,b)=>a+ +b,0);
const reduce12  = n => { while(n>12) n=sumDigits(n); return n||12; };

function buildPositions(iso){ // YYYY-MM-DD
  const [Y,M,D] = iso.split('-').map(Number);
  const P = {};
  P.P1  = reduce12(D);
  P.P2  = reduce12(M);
  P.P3  = reduce12(sumDigits(Y));
  P.P4  = reduce12(P.P1 + P.P2);
  P.P5  = reduce12(P.P1 + P.P3);
  P.P6  = reduce12(P.P2 + P.P3);
  P.P7  = reduce12(P.P4 + P.P5);
  P.P8  = reduce12(P.P4 + P.P6);
  P.P9  = reduce12(P.P5 + P.P6);
  P.P10 = reduce12(P.P7 + P.P8);
  P.P11 = reduce12(P.P7 + P.P9);
  P.P12 = reduce12(P.P8 + P.P9);

  // ВЯ: День + Месяц + век (19/20) + десяток года (единицу не берём)
  const century = Math.floor(Y/100);                   // 19 или 20
  const decade  = Math.floor((Y % 100) / 10);          // 0..9
  const vy = D + M + century + decade;

  return {P, vy};
}

/* ===== коды ===== */
function computeCodes(P){
  const N1 = P.P5;                   // Свет–Любовь
  const N2 = P.P8;                   // Сила–Воля
  const N3 = reduce12(P.P5 + P.P8);  // простукивание

  const T1 = reduce12(P.P8 + P.P10 + P.P12); // верхняя
  const T2 = reduce12(P.P1 + P.P3 + P.P5);   // нижняя
  const T3 = reduce12(T1 + T2);              // гармонизация

  const C1 = reduce12(P.P2 + P.P4 + P.P6);   // вперёд
  const C2 = reduce12(P.P7 + P.P9 + P.P11);  // назад
  const C3 = reduce12(C1 + C2);              // фиксация

  return {N1,N2,N3,T1,T2,T3,C1,C2,C3};
}

/* ===== рендер ===== */
function classFor(v){ return 'c'+(v||12); }

function renderGrid(P){
  const order = [P.P10,P.P11,P.P12, P.P7,P.P8,P.P9, P.P4,P.P5,P.P6, P.P1,P.P2,P.P3];
  const g = $('#grid'); g.innerHTML='';
  order.forEach(v=>{
    const d=document.createElement('div');
    d.className='cell '+classFor(v);
    d.textContent=v;
    g.appendChild(d);
  });
}
function renderVY(vy){
  const L = detectLang();
  $('#vy').innerHTML = `<span>${I18N[L].vy}</span><b>${vy}</b>`;
}
function renderInstr(P){
  const L = detectLang(), t = I18N[L];
  const C = computeCodes(P);
  // чипы
  $('#n1').textContent = C.N1; $('#n2').textContent = C.N2; $('#n3').textContent = C.N3;
  // тексты (полные, без урезаний)
  $('#acc1b').innerHTML = t.a1(C.N1,C.N2,C.N3);
  $('#acc2b').innerHTML = t.a2(C.T1,C.T2,C.T3);
  $('#acc3b').innerHTML = t.a3(C.C1,C.C2,C.C3);
}

function renderAll(iso){
  const {P,vy} = buildPositions(iso);
  window._lastISO = iso;
  renderVY(vy);
  renderGrid(P);
  renderInstr(P);
}

/* ===== события ===== */
document.querySelectorAll('.acc .accHead').forEach(h=>{
  h.addEventListener('click', ()=> h.parentElement.classList.toggle('open'));
});
$('#calcBtn').addEventListener('click', ()=>{ const iso=$('#dob').value; if(iso) renderAll(iso); });
$('#lang').addEventListener('change', applyLang);

/* ===== PDF ===== */
$('#pdfBtn').addEventListener('click', async ()=>{
  const area = document.querySelector('.wrap');
  const canvas = await html2canvas(area,{scale:2,backgroundColor:'#0f1220'});
  const img = canvas.toDataURL('image/png');
  const pdf = new jspdf.jsPDF('p','mm','a4');
  const pageW = pdf.internal.pageSize.getWidth();
  const imgW = pageW-16;
  const imgH = imgW * (canvas.height/canvas.width);
  pdf.addImage(img,'PNG',8,8,imgW,imgH,'','FAST');
  pdf.save('SoulCrystal.pdf');
});

/* ===== init ===== */
(function boot(){
  // дата по умолчанию — сегодня
  const d = new Date(), pad=n=>String(n).padStart(2,'0');
  $('#dob').value = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  applyLang();
  renderAll($('#dob').value);
  // раскроем первую секцию по умолчанию
  document.getElementById('acc1').classList.add('open');
})();
</script>
</body>
</html>
