<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Раскрой свой КРИСТАЛЛ ДУШИ</title>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0d1020;--ink:#eaf0ff;--muted:#a7b0d8;
    --radius:18px;--gap:14px;--shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:Manrope,system-ui,Arial,sans-serif}
  .wrap{max-width:980px;margin:auto;padding:22px}
  h1{margin:8px 0 16px;text-align:center;font-weight:900;letter-spacing:.4px;font-size:clamp(24px,4.8vw,44px)}
  h1 .glow{display:inline-block;color:#ffe69c;text-shadow:0 0 24px rgba(255,217,102,.6),0 0 48px rgba(255,217,102,.25)}

  .panel{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow);
    border-radius:var(--radius);padding:16px;margin:16px 0}

  .row{display:flex;flex-wrap:wrap;gap:14px}
  .control{flex:1;min-width:240px}
  label{display:block;margin:0 0 6px 6px;font-size:13px;color:var(--muted)}
  input[type="date"],select{width:100%;padding:15px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:#0f1533;color:var(--ink);outline:none}
  .langbar{display:flex;gap:10px;align-items:end;flex-wrap:wrap}

  .btn{appearance:none;border:0;border-radius:14px;padding:15px 20px;font-weight:800;letter-spacing:.2px;cursor:pointer;transition:.2s transform,.2s box-shadow,.2s filter}
  .btn:active{transform:translateY(1px)}
  .btn.primary{background:linear-gradient(135deg,#71e2ff,#7afcc5);color:#0b1230;box-shadow:0 10px 28px rgba(61,209,255,.28),inset 0 1px 0 rgba(255,255,255,.5)}
  .btn.primary:hover{box-shadow:0 14px 36px rgba(61,209,255,.36),inset 0 1px 0 rgba(255,255,255,.55)}
  .btn.ghost{background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));color:var(--ink);border:1px solid rgba(255,255,255,.16)}

  .vy{font-size:22px;font-weight:800;margin:8px 0 14px;text-align:center}

  /* Сетка 3×4, снизу вверх */
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
  .cell{
    aspect-ratio:1/1;border-radius:18px;display:flex;align-items:center;justify-content:center;
    font-weight:900;font-size:32px;color:#0d1020;
    box-shadow:inset 0 0 0 1px rgba(0,0,0,.22), 0 10px 30px rgba(0,0,0,.28);
    position:relative; overflow:hidden;
    /* кристаллическое свечение (общий мягкий хайлайт) */
    background-image:radial-gradient(circle at 50% 42%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 56%);
  }
  .cell::after{
    content:""; position:absolute; inset:0; border-radius:inherit;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.12);
    pointer-events:none;
  }

  /* Палитра 1–12: центр светлее → к краю темнее, в ТВОИХ цветах */
  .n-1 { background:
    radial-gradient(circle at 50% 60%, #ffb3b3 0%, #ff6b6b 55%, #d93a3a 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 56%); }
  .n-2 { background:
    radial-gradient(circle at 50% 60%, #ffd1a6 0%, #ff9f43 55%, #d97600 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 56%); }
  .n-3 { background:
    radial-gradient(circle at 50% 60%, #ffeaa6 0%, #ffd43b 55%, #caa400 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 56%); }
  .n-4 { background:
    radial-gradient(circle at 50% 60%, #e7ffbf 0%, #a7ea5a 55%, #6ec100 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 56%); }
  .n-5 { color:#fff; text-shadow:0 1px 0 rgba(0,0,0,.45); background:
    radial-gradient(circle at 50% 60%, #bfe9c3 0%, #2e7d32 55%, #1f5a22 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.65) 0%, rgba(255,255,255,0) 56%); }
  .n-6 { background:
    radial-gradient(circle at 50% 60%, #b9f5f2 0%, #36c0b9 55%, #1b8f89 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 56%); }
  .n-7 { color:#fff; text-shadow:0 1px 0 rgba(0,0,0,.45); background:
    radial-gradient(circle at 50% 60%, #b7d0ff 0%, #2f6ed8 55%, #17408b 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.60) 0%, rgba(255,255,255,0) 56%); }
  .n-8 { background:
    radial-gradient(circle at 50% 60%, #c9e8ff 0%, #5aa9e6 55%, #2f78b7 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 56%); }
  .n-9 { color:#fff; text-shadow:0 1px 0 rgba(0,0,0,.45); background:
    radial-gradient(circle at 50% 60%, #e0c6ff 0%, #8b5cf6 55%, #5b22b0 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.60) 0%, rgba(255,255,255,0) 56%); }
  .n-10{ background:
    radial-gradient(circle at 50% 60%, #ffd7ef 0%, #d66ad2 55%, #9b2fa2 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.70) 0%, rgba(255,255,255,0) 56%); }
  .n-11{ background:
    radial-gradient(circle at 50% 60%, #ffc0da 0%, #ff4fa0 55%, #c60064 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.70) 0%, rgba(255,255,255,0) 56%); }
  .n-12{ background:
    radial-gradient(circle at 50% 60%, #ffe1ec 0%, #ff9bc2 55%, #ff6b9e 100%),
    radial-gradient(circle at 50% 42%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 56%); }

  .inst h2{margin:0 0 12px}
  .cards{display:flex;flex-direction:column;gap:14px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.09);border-radius:18px;padding:16px 18px}
  .card h3{margin:0 0 8px;font-size:18px;letter-spacing:.3px}
  .card.red h3{color:#ff7d7d}.card.blue h3{color:#79a8ff}.card.green h3{color:#54e0a3}
  .muted{color:#cdd6ff}
  .kv{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .pill{background:#0f1533;border:1px solid rgba(255,255,255,.12);color:#d4ddff;border-radius:12px;padding:6px 10px;font-size:13px}
  .note{opacity:.85;text-align:center;margin:10px 0 30px;color:#aab3da}

  @media (max-width:720px){.btn{width:100%}.cell{font-size:28px}}
</style>
</head>
<body>
<div class="wrap">
  <h1><span>Раскрой свой</span><br><span class="glow">КРИСТАЛЛ ДУШИ</span></h1>

  <!-- Панель управления (в PDF не попадает) -->
  <section class="panel" data-html2canvas-ignore="true">
    <div class="row">
      <div class="control" style="flex:2;min-width:260px">
        <label>Дата рождения</label>
        <input id="dob" type="date">
      </div>
      <div class="control">
        <label>Язык</label>
        <div class="langbar">
          <select id="lang">
            <option value="ru">Русский</option>
            <option value="en">English</option>
            <option value="uk">Українська</option>
            <option value="bg">Български</option>
          </select>
          <button id="calc" class="btn primary">Рассчитать</button>
          <button id="pdf" class="btn ghost">Скачать PDF</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ПАНЕЛЬ 1: Матрица + ВЯ (идёт в PDF) -->
  <section class="panel" id="panel-matrix">
    <div class="vy">Уровень Высшего Я: <span id="vyVal">—</span></div>
    <div id="grid" class="grid">
      <!-- P10 P11 P12 / P7 P8 P9 / P4 P5 P6 / P1 P2 P3 -->
      <div class="cell" id="P10">—</div><div class="cell" id="P11">—</div><div class="cell" id="P12">—</div>
      <div class="cell" id="P7">—</div><div class="cell" id="P8">—</div><div class="cell" id="P9">—</div>
      <div class="cell" id="P4">—</div><div class="cell" id="P5">—</div><div class="cell" id="P6">—</div>
      <div class="cell" id="P1">—</div><div class="cell" id="P2">—</div><div class="cell" id="P3">—</div>
    </div>
  </section>

  <!-- ПАНЕЛЬ 2: Инструкция (идёт в PDF) -->
  <section class="panel inst" id="panel-inst">
    <h2>Инструкция к кодам</h2>
    <div class="cards">
      <!-- 1 -->
      <article class="card red">
        <h3>1) АКТИВАЦИЯ КОНТАКТА С ДУШОЙ ( соединение разума и сердца).</h3>
        <div class="muted" id="k1text">
          <p><b>Дыхание с фокусом на Высшем сердце (Тимус).</b></p>
          <ul>
            <li>Сложи ладони в «намасте» на уровне груди и сделай вдох из  самого центра головы опуская луч серебристой энергии в центр груди.
            Затем разведи руки на всю ширину на уровне груди и сделай выдох золотой энергии из Тимуса в мир со звуком "Ха". 
            Делай это <b><span id="n1v">N1</span></b> раз.</li>
          </ul>
          <p><i>Мысленная формула:</i> «ВДЫХАЮ СВЕТ — ВЫДЫХАЮ ЛЮБОВЬ!»<br>
          Представляй, как с каждым выдохом вокруг тебя образуется защитное облако золотого света.</p>
          <ul>
            <li>Далее — со сложенными на груди руками: на вдохе втягивай поток огненной энергии из солнечного сплетения (нижняя сердечная чакра) к Тимусу и с распрастертыми в ширину руками, выдыхай в мир золотую энергию Любви, издавая звук "Ха". 
            — Делай это <b><span id="n2v">N2</span></b> раз.</li>
          </ul>
          <p><i>Мысленная формула:</i> «ВДЫХАЮ СИЛУ — ВЫДЫХАЮ ЛЮБОВЬ!»<br>
          Также визуализируй золотое защитное облако.<br>
          Серебристый и огненный потоки создают энергию золотого света и сонастраиваются с вибрацией твоей Души.</p>
          <p>Представь в груди светящийся золотым сиянием Кристалл — портал между телом и твоей светоносной копией.</p>
          <ul>
            <li>Затем простучи точку Тимуса, протяжно звуча «аа». Делай это <b><span id="n3v">N3</span></b> раз.</li>
          </ul>
          <div class="kv">
            <span class="pill">N1: <span id="n1v_pill">—</span></span>
            <span class="pill">N2: <span id="n2v_pill">—</span></span>
            <span class="pill">N3: <span id="n3v_pill">—</span></span>
          </div>
        </div>
      </article>

      <!-- 2 -->
      <article class="card blue">
        <h3>2) АКТИВАЦИЯ МЕРКАБА (духовное пробуждение в физическом теле)</h3>
        <div class="muted" id="k2text">
          <ul>
            <li>Поднимаем вытянутые руки в намастэ над макушкой (30 см над головой), соединяясь со своим ВЯ. 
            Разводим руки в стороны, образуя воронку. И начинаем раскручиваться вокруг своей оси по часовой стрелке, запуская в свое тело космическую энергию.
            — Делаем <b><span id="t1v">T1</span></b> раз.</li>
            <li>Представляем шнур, который выходит из промежности и соединяет нас с землей ( на 30 см ниже поверхности земли.)  Руки при этом опускаем ладонями вниз но расставленными на ширину плеч, образуя нижнюю воронку. Начинаем крутиться вокруг своей оси, но уже против часовой стрелки, втягивая в себя энергию земли.
            — Делаем <b><span id="t2v">T2</span></b> раз.</li>
            <li>Гармонизируем эти два потока, соединяя руки в намасте в центре груди и подпрыгиваем на месте ( или подъемы на носок с резким опусканием на пятки) .
            — Делаем это <b><span id="t3v">T3</span></b> раз.</li>
          </ul>
          <div class="kv">
            <span class="pill">T1: <span id="t1v_pill">—</span></span>
            <span class="pill">T2: <span id="t2v_pill">—</span></span>
            <span class="pill">T3: <span id="t3v_pill">—</span></span>
          </div>
        </div>
      </article>

      <!-- 3 -->
      <article class="card green">
        <h3>3) ЗАПУСК ТОРОИДАЛЬНОГО ПОЛЯ (полная интеграция физического тела с телом Света).</h3>
        <div class="muted" id="k3text">
          <ul>
            <li>Занимаем вертикальное положение.
            Разводим руки в стороны параллельно земле на максимальную ширину. Делаем вращательные движение руками вперёд (обе одновременно) <b><span id="c1v">C1</span></b> раз.</li>
            <li>Теперь делаем вращательные движение обеими  руками назад (обе одновременно) <b><span id="c2v">C2</span></b> раз.</li>
            <li>Фиксация — соединяем руки на груди в «намасте» и ладошками давим друг на друга, вызыаая напряжение грудных мышц.
            — Делаем это <b><span id="c3v">C3</span></b> раз.</li>
          </ul>
          <div class="kv">
            <span class="pill">C1: <span id="c1v_pill">—</span></span>
            <span class="pill">C2: <span id="c2v_pill">—</span></span>
            <span class="pill">C3: <span id="c3v_pill">—</span></span>
          </div>
        </div>
      </article>
    </div>
  </section>

  <p class="note">PDF включает матрицу (с уровнем ВЯ) и полный текст трёх пунктов.</p>
</div>

<!-- Библиотеки -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
/* ===== УТИЛЫ ===== */
const sumDigits = n => String(Math.abs(n)).split('').reduce((a,b)=>a + (+b), 0);
const to12 = n => { let m = n; while(m > 12) m = sumDigits(m); return m || 12; };

/* ===== РАСЧЁТ МАТРИЦЫ (как в твоей базе) ===== */
function buildPositions(iso){
  const [Y,M,D] = iso.split('-').map(Number);
  const P1=to12(sumDigits(D)), P2=to12(M), P3=to12(sumDigits(Y));
  const P4=to12(P1+P2), P5=to12(P1+P3), P6=to12(P2+P3);
  const P7=to12(P4+P5), P8=to12(P4+P6), P9=to12(P5+P6);
  const P10=to12(P7+P8), P11=to12(P7+P9), P12=to12(P8+P9);
  return {Y,M,D,P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12};
}
function computeVY({Y,M,D}){ return D + M + Math.floor(Y/100) + Math.floor((Y%100)/10); }

/* ===== СЧЁТЧИКИ ДЛЯ ИНСТРУКЦИИ (как в твоей базе) =====
   N1=P5, N2=P8, N3=to12(P5+P8)
   T1=to12(P8+P10+P12), T2=to12(P1+P3+P5), T3=to12(T1+T2)
   C1=to12(P2+P4+P6),   C2=to12(P7+P9+P11), C3=to12(C1+C2)
*/
function computeCounts(P){
  const N1=P.P5, N2=P.P8, N3=to12(P.P5+P.P8);
  const T1=to12(P.P8+P.P10+P.P12), T2=to12(P.P1+P.P3+P.P5), T3=to12(T1+T2);
  const C1=to12(P.P2+P.P4+P.P6),   C2=to12(P.P7+P.P9+P.P11), C3=to12(C1+C2);
  return {N1,N2,N3,T1,T2,T3,C1,C2,C3};
}

/* ===== ОТРИСОВКА ===== */
function setCell(el,val){ el.textContent=val; el.className='cell n-'+val; }
function drawGrid(P){
  ["P10","P11","P12","P7","P8","P9","P4","P5","P6","P1","P2","P3"]
    .forEach(id=>setCell(document.getElementById(id),P[id]));
}
function fillInstructionCounts(cnt){
  // Вставляем числа и в текст, и в плашки
  const m = new Map([
    ['n1v',cnt.N1],['n2v',cnt.N2],['n3v',cnt.N3],
    ['t1v',cnt.T1],['t2v',cnt.T2],['t3v',cnt.T3],
    ['c1v',cnt.C1],['c2v',cnt.C2],['c3v',cnt.C3],
    ['n1v_pill',cnt.N1],['n2v_pill',cnt.N2],['n3v_pill',cnt.N3],
    ['t1v_pill',cnt.T1],['t2v_pill',cnt.T2],['t3v_pill',cnt.T3],
    ['c1v_pill',cnt.C1],['c2v_pill',cnt.C2],['c3v_pill',cnt.C3],
  ]);
  m.forEach((v,id)=>{ const el=document.getElementById(id); if(el) el.textContent=v; });
}

function recalc(){
  const iso = document.getElementById('dob').value;
  if(!iso){ alert('Выбери дату'); return; }
  const P = buildPositions(iso);
  drawGrid(P);
  document.getElementById('vyVal').textContent = computeVY(P);
  fillInstructionCounts(computeCounts(P));
}

/* ===== PDF: ТОЛЬКО панель матрицы + панель инструкции ===== */
document.getElementById('pdf').addEventListener('click', async ()=>{
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({unit:"pt",format:"a4"});
  const pw = pdf.internal.pageSize.getWidth(), ph = pdf.internal.pageSize.getHeight();

  async function shot(node){
    // Клон без теней/бордеров — чтобы не было «мусорных» слоёв
    const clone = node.cloneNode(true);
    clone.style.background = 'transparent';
    clone.style.boxShadow = 'none';
    clone.querySelectorAll('*').forEach(n=>{ n.style.boxShadow='none'; n.style.border='none'; });
    const tmp = document.createElement('div');
    tmp.style.position='fixed'; tmp.style.left='-9999px'; tmp.style.top='0';
    tmp.style.width='920px'; tmp.appendChild(clone);
    document.body.appendChild(tmp);
    const canvas = await html2canvas(clone,{backgroundColor:"#ffffff",scale:2,useCORS:true});
    document.body.removeChild(tmp);
    const img = canvas.toDataURL('image/png');
    const r = Math.min((pw-80)/canvas.width,(ph-120)/canvas.height);
    pdf.addImage(img,'PNG',40,40,canvas.width*r,canvas.height*r);
  }

  try{
    pdf.setFillColor(255,255,255); pdf.rect(0,0,pw,ph,'F');
    await shot(document.getElementById('panel-matrix'));
    pdf.addPage(); await shot(document.getElementById('panel-inst'));
    pdf.save('Kristall_dushi.pdf');
  }catch(e){
    alert('Не удалось сформировать PDF: '+e.message);
  }
});

/* ===== INIT ===== */
document.getElementById('calc').addEventListener('click', recalc);
document.getElementById('lang').addEventListener('change', ()=>{/* язык оставляем как в базе, без автоперевода инструкции */});
(function(){
  document.getElementById('dob').value = '1969-05-22';
  recalc();
})();
</script>
</body>
</html>
