<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Кристалл Души — Калькулятор</title>
<style>
  :root{
    --bg:#0f1220; --panel:#11162a; --ink:#eaf2ff; --muted:#a9b6d3; --accent:#77e3ff;
    --radius:18px; --gap:10px; --shadow:0 8px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;background:radial-gradient(1200px 800px at 70% -10%,#1b2250,transparent),var(--bg);color:var(--ink)}
  .wrap{max-width:980px;margin:auto;padding:28px}
  header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:22px}
  h1{font-weight:700;letter-spacing:.3px;margin:0;font-size:clamp(22px,3.5vw,30px)}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);box-shadow:var(--shadow)}
  .row{display:flex;flex-wrap:wrap;gap:16px}
  .panel{padding:16px}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type="text"], input[type="date"]{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:#0e1330;color:#eaf2ff;outline:none}
  .controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
  button{appearance:none;border:0;padding:10px 14px;border-radius:12px;background:#1b7be0;color:white;font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(27,123,224,.35);transition:.2s}
  button:hover{transform:translateY(-1px)}
  button.secondary{background:#2a305a;color:#d2defc;box-shadow:none;border:1px solid rgba(255,255,255,.1)}

  /* Matrix */
  .matrix{display:grid;grid-template-columns:repeat(3,minmax(120px,1fr));gap:var(--gap);padding:16px}
  .cell{position:relative;border-radius:14px;padding:18px;text-align:center;font-weight:800;font-size:28px;color:#fff;isolation:isolate;box-shadow:inset 0 0 0 1px rgba(255,255,255,.12),0 6px 20px rgba(0,0,0,.35)}
  .cell::before{content:"";position:absolute;inset:0;border-radius:inherit;background:radial-gradient(120px 120px at 50% 40%,rgba(255,255,255,.25),transparent 60%);z-index:-1}
  .level{padding:6px 12px;margin:0 0 4px 12px;border-radius:999px;background:rgba(255,255,255,.06);color:#d6e2ff;font-weight:700;font-size:12px;display:inline-block;border:1px solid rgba(255,255,255,.08)}
  .gridBlock{margin-top:14px}
  .levels{display:grid;grid-template-columns:1fr;gap:6px;padding:10px 16px 0 16px;color:var(--muted);font-size:12px}
  .levels span{opacity:.9}

  /* Colors 1–12 */
  .c1{background:#ff2a2a}
  .c2{background:#ff8c24}
  .c3{background:#ffd325;color:#3b2f00}
  .c4{background:#b7ff47;color:#10360c}
  .c5{background:#1f7a39}
  .c6{background:#50d4cf;color:#082b2a}
  .c7{background:#2f69ff}
  .c8{background:#9bd0ff;color:#0a2340}
  .c9{background:#7f46d7}
  .c10{background:#d47fcf}
  .c11{background:#ff4ca3}
  .c12{background:#ffb6cf;color:#35121e}

  /* Results */
  .results{display:grid;grid-template-columns:repeat(3,minmax(220px,1fr));gap:14px;padding:16px}
  .result{padding:14px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08)}
  .result h3{margin:2px 0 8px 0;font-size:15px;color:#dbe6ff}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#121836;border:1px solid rgba(255,255,255,.1);font-weight:700}
  .pill .num{font-size:16px;min-width:20px;text-align:center}
  .split{height:1px;background:rgba(255,255,255,.08);margin:10px 0}
  .foot{margin-top:16px;color:var(--muted);font-size:12px;text-align:center}

  @media (max-width:720px){
    .results{grid-template-columns:1fr}
    .matrix{grid-template-columns:repeat(3,1fr)}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Кристалл Души — Калькулятор (12 позиций)</h1>
      <div class="level">v1.1 • алгоритм снизу вверх</div>
    </header>

    <div class="card panel">
      <div class="row">
        <div style="flex:1 1 240px;min-width:260px">
          <label>Дата рождения (можно выбрать или ввести цифрами без точек: <b>ДДММГГГГ</b>)</label>
          <input id="date" type="date" />
          <div class="controls">
            <input id="digits" type="text" placeholder="например: 22051969" inputmode="numeric" pattern="[0-9]*" style="max-width:200px"/>
            <button id="calcBtn">Рассчитать</button>
            <button class="secondary" id="demoBtn" title="Проверка 22.05.1969">Пример</button>
          </div>
        </div>
      </div>
    </div>

    <div class="gridBlock card">
      <div class="levels">
        <span>Нумерация позиций снизу вверх, слева направо:</span>
        <span><b>низ:</b> П1 П2 П3 • <b>2-я:</b> П4 П5 П6 • <b>3-я:</b> П7 П8 П9 • <b>верх:</b> П10 П11 П12</span>
      </div>
      <div id="matrix" class="matrix"></div>
    </div>

    <div class="card results" id="results">
      <div class="result">
        <h3>АКТИВАЦИЯ ТОРСИОННОГО ПОЛЯ</h3>
        <div class="pill">Духовная Меркаба (П8+П10+П12): <span class="num" id="dm"></span></div>
        <div class="pill" style="margin-top:8px">Материальная Меркаба (П1+П3+П5): <span class="num" id="mm"></span></div>
        <div class="split"></div>
        <div class="pill">Троичный код гармонии: <span class="num" id="tk1"></span> — <span class="num" id="tk2"></span> — <span class="num" id="tk3"></span></div>
      </div>
      <div class="result">
        <h3>АКТИВАЦИЯ ТЕЛА СВЕТА</h3>
        <div class="pill">Верх (П7+П9+П11): <span class="num" id="top"></span></div>
        <div class="pill" style="margin-top:8px">Низ (П2+П4+П6): <span class="num" id="bottom"></span></div>
        <div class="split"></div>
        <div class="pill">Троичный код целостности: <span class="num" id="ts1"></span> — <span class="num" id="ts2"></span> — <span class="num" id="ts3"></span></div>
      </div>
      <div class="result">
        <h3>Базовые числа</h3>
        <div class="pill">П1 (день): <span class="num" id="p1"></span></div>
        <div class="pill" style="margin-top:8px">П2 (месяц): <span class="num" id="p2"></span></div>
        <div class="pill" style="margin-top:8px">П3 (год → сумма цифр): <span class="num" id="p3"></span></div>
      </div>
      <div class="result">
        <h3>УРОВЕНЬ ВЫСШЕГО Я (ВЯ)</h3>
        <div class="pill">Формула: День + Месяц + (Столетие + две последние цифры года, сведённые до 9)</div>
        <div class="split"></div>
        <div class="pill">ВЯ: <span class="num" id="vy"></span></div>
      </div>
      <div class="result">
        <h3>АКТИВАЦИЯ ИНДИВИДУАЛЬНОЙ ДУШИ</h3>
        <div class="pill">П.5 = <span class="num" id="sp5"></span> • П.8 = <span class="num" id="sp8"></span></div>
        <div class="pill" style="margin-top:8px">Сумма (сведение к 1–12): <span class="num" id="ssum"></span></div>
        <div class="split"></div>
        <div class="pill">Троичный код: <span class="num" id="sc1"></span> — <span class="num" id="sc2"></span> — <span class="num" id="sc3"></span></div>
      </div>
    </div>

    <p class="foot">Цвета ячеек соответствуют 12 энергиям: 1 — красный, 2 — оранжевый, 3 — жёлтый, 4 — салатовый, 5 — тёмно-зелёный, 6 — бирюзовый, 7 — синий, 8 — голубой, 9 — фиолетовый, 10 — лилово-розовый, 11 — ярко-розовый, 12 — светло-розовый.</p>
  </div>

<script>
// ===== Утилиты =====
const sumDigits = (n)=> String(n).split("").reduce((a,b)=>a+Number(b),0);
const reduce12 = (n)=>{ n = Number(n)||0; while(n>12){ n = sumDigits(n); } return n===0?12:n; };
const reduce9  = (n)=>{ n = Number(n)||0; while(n>9){ n = sumDigits(n); } return n===0?9:n; };
const colorClass = (v)=> `c${v}`; // 1..12

// ===== Матрица 12 позиций =====
function buildMatrixFromDate(d, m, y){
  const A = reduce12(d), B = reduce12(m), C = reduce12(sumDigits(y));
  const P1=A, P2=B, P3=C;
  const P4=reduce12(P1+P2);
  const P5=reduce12(P1+P3);
  const P6=reduce12(P2+P3);
  const P7=reduce12(P4+P5);
  const P8=reduce12(P4+P6);
  const P9=reduce12(P5+P6);
  const P10=reduce12(P7+P8);
  const P11=reduce12(P7+P9);
  const P12=reduce12(P8+P9);
  return [P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12];
}

function renderMatrix(arr){
  const matrixEl = document.getElementById('matrix');
  matrixEl.innerHTML = '';
  const order = [9,10,11, 6,7,8, 3,4,5, 0,1,2];
  const labels = ["П10","П11","П12","П7","П8","П9","П4","П5","П6","П1","П2","П3"];
  order.forEach((idx,i)=>{
    const v = arr[idx];
    const div = document.createElement('div');
    div.className = `cell ${colorClass(v)}`;
    div.title = labels[i];
    div.innerHTML = `<div style="position:absolute;left:10px;top:8px;font:600 12px/1 system-ui;color:rgba(255,255,255,.9);opacity:.9">${labels[i]}</div>${v}`;
    matrixEl.appendChild(div);
  });
}

// ===== Коды =====
function computeCodes(P){
  const [P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12] = P;
  // Торсионное поле
  const DM  = reduce12(P8 + P10 + P12);
  const MM  = reduce12(P1 + P3 + P5);
  const TK1 = DM, TK2 = MM, TK3 = reduce12(DM + MM);
  // Тело Света
  const TOP = reduce12(P7 + P9 + P11);
  const BOT = reduce12(P2 + P4 + P6);
  const T3  = reduce12(TOP + BOT);
  // Индивидуальная Душа (П.5 + П.8) → троичный: П8, сумма, П5
  const soulSum = reduce12(P5 + P8);
  const SC1 = P8, SC2 = soulSum, SC3 = P5;
  return {DM,MM,TK1,TK2,TK3,TOP,BOT,T3,SC1,SC2,SC3,P5,P8};
}

// ===== ВЫСШЕЕ Я =====
function computeVY(D,M,Y){
  // День и месяц — без сведения. Год: столетие (19/20) + последние две цифры, сведённые до 1..9.
  const century = Math.floor(Y/100); // 19 или 20
  const tail = Y % 100;              // 00..99
  const duo9 = reduce9(tail);         // сводим до 1..9
  const vy = (Number(D)||0) + (Number(M)||0) + century + duo9;
  return {vy, century, duo9};
}

function paintResults(P, codes, vyPack){
  const id=(x)=>document.getElementById(x);
  id('p1').textContent=P[0];
  id('p2').textContent=P[1];
  id('p3').textContent=P[2];
  id('dm').textContent=codes.DM;
  id('mm').textContent=codes.MM;
  id('tk1').textContent=codes.TK1;
  id('tk2').textContent=codes.TK2;
  id('tk3').textContent=codes.TK3;
  id('top').textContent=codes.TOP;
  id('bottom').textContent=codes.BOT;
  id('ts1').textContent=codes.TOP;
  id('ts2').textContent=codes.BOT;
  id('ts3').textContent=codes.T3;
  // ВЯ
  id('vy').textContent = vyPack.vy;
  // Индивидуальная Душа
  id('sp5').textContent = codes.P5;
  id('sp8').textContent = codes.P8;
  id('ssum').textContent = codes.SC2;
  id('sc1').textContent = codes.SC1;
  id('sc2').textContent = codes.SC2;
  id('sc3').textContent = codes.SC3;
}

// ===== Ввод и запуск =====
function parseInputs(){
  const dateEl = document.getElementById('date');
  const digitsEl = document.getElementById('digits');
  let D, M, Y;
  if(digitsEl.value.trim()){
    const t = digitsEl.value.trim().replace(/[^0-9]/g,'');
    if(t.length!==8) throw new Error('Введите 8 цифр: ДДММГГГГ');
    D = Number(t.slice(0,2));
    M = Number(t.slice(2,4));
    Y = Number(t.slice(4,8));
  } else if(dateEl.value){
    const [y,m,d] = dateEl.value.split('-').map(Number);
    D=d; M=m; Y=y;
  } else {
    throw new Error('Укажите дату рождения.');
  }
  return {D,M,Y};
}

function run(){
  try{
    const {D,M,Y} = parseInputs();
    const P = buildMatrixFromDate(D,M,Y);
    renderMatrix(P);
    const codes = computeCodes(P);
    const vyPack = computeVY(D,M,Y);
    paintResults(P, codes, vyPack);
  }catch(e){
    alert(e.message);
  }
}

document.getElementById('demoBtn').addEventListener('click',()=>{
  document.getElementById('date').value = '';
  document.getElementById('digits').value = '22051969';
  run();
});

document.getElementById('calcBtn').addEventListener('click', run);

window.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('digits').value = '22051969';
  run();
});
</script>
</body>
</html>
