<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>РАСКРОЙ СВОЙ КРИСТАЛЛ ДУШИ</title>
<style>
  :root{
    --bg:#0f1220; --panel:#141b3a; --ink:#eaf3ff; --muted:#9fb0d8; --ring:#34406a;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:980px;margin:auto;padding:22px}
  h1{margin:8px 0 16px;text-align:center;line-height:1.15;font-weight:800;font-size:clamp(24px,5vw,44px)}
  .glow{color:#ffd966;text-shadow:0 0 6px #ffebb0,0 0 12px #ffd966,0 0 22px #ffcc33}

  .panel{background:#131937;border-radius:16px;padding:16px;margin:14px 0}
  .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;align-items:end}
  .field{display:flex;flex-direction:column;gap:6px;background:#101735;border:1px solid var(--ring);padding:10px 12px;border-radius:10px}
  .field span{font-size:14px;color:var(--muted)}
  input[type="date"], select{background:transparent;border:0;color:var(--ink);font-size:16px;outline:none}
  .row{display:flex;gap:10px;align-items:center}
  .checkbox{display:flex;align-items:center;gap:6px;background:#101735;border:1px solid var(--ring);padding:10px 12px;border-radius:10px}
  .checkbox input{accent-color:#2d6ae0}

  button{cursor:pointer;border:0;border-radius:12px;padding:12px 16px;font-weight:700}
  .primary{background:#2d6ae0;color:#fff}
  .secondary{background:#3b476f;color:#fff}

  .badge{display:inline-block;background:#1a244d;border:1px solid var(--ring);border-radius:999px;padding:8px 14px;margin:8px 0}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;max-width:460px;margin:16px auto}
  .cell{position:relative;border-radius:14px;padding:26px 0;text-align:center;font-weight:900;font-size:26px;color:#00110d;box-shadow:0 8px 20px rgba(0,0,0,.28)}
  .cell small{position:absolute;left:8px;top:6px;font:700 11px/1 system-ui;color:rgba(0,0,0,.65)}

  /* палитра 1..12 */
  .c1{background:#ff6b6b}.c2{background:#ff994d}.c3{background:#ffd54d}.c4{background:#b8ff6e}
  .c5{background:#24a148;color:#eafff5}.c6{background:#9ee5ff}.c7{background:#5294ff;color:#eef6ff}
  .c8{background:#cfe5ff}.c9{background:#9b6cff;color:#fff}.c10{background:#cba6ff}.c11{background:#ff78c6}.c12{background:#ffc7d7}

  .card{background:#1b2145;border-radius:16px;padding:16px;margin:12px auto;max-width:780px}
  .card h3{margin:0 0 10px;text-align:center}
  .pill{display:inline-block;background:#101735;border:1px solid var(--ring);border-radius:999px;padding:6px 10px;margin:3px 6px;font-weight:700}
  .muted{color:var(--muted)}
  .para{margin:8px 0 12px}
</style>
</head>
<body>
<div class="wrap">
  <h1 id="title">
    <span id="t_reveal">РАСКРОЙ СВОЙ</span><br>
    <span class="glow">КРИСТАЛЛ ДУШИ</span>
  </h1>

  <div class="panel">
    <div class="controls">
      <label class="field">
        <span id="t_birthdate">Дата рождения</span>
        <input type="date" id="date" />
      </label>
      <div class="row">
        <label class="field">
          <span id="t_language">Язык</span>
          <select id="lang">
            <option value="auto">Auto</option>
            <option value="ru">Русский</option>
            <option value="en">English</option>
          </select>
        </label>
        <label class="checkbox">
          <input type="checkbox" id="autoLang" />
          <span id="t_auto">Авто</span>
        </label>
      </div>
      <button class="primary" id="btnCalc">Рассчитать</button>
      <button class="secondary" id="btnPdf">Скачать PDF</button>
    </div>
  </div>

  <div class="badge" id="vyBadge">—</div>

  <div id="matrix" class="grid"></div>

  <div class="card" id="codes">
    <h3 id="codesTitle">Троичные коды</h3>
    <div id="codesBody"></div>
  </div>

  <div class="card" id="howto">
    <h3 id="howtoTitle">Инструкция к кодам</h3>
    <div id="howtoBody"></div>
  </div>
</div>

<script>
/* ===== i18n ===== */
const TR = {
  ru:{
    reveal:"РАСКРОЙ СВОЙ",
    birthdate:"Дата рождения",
    language:"Язык",
    auto:"Авто",
    calc:"Рассчитать",
    pdf:"Скачать PDF",
    vy:v=>`Уровень Высшего Я: ${v}`,
    codesTitle:"Троичные коды",
    torsion:"Активация торсионного поля",
    light:"Активация тела света",
    soul:"Активация индивидуальной души",
    howtoTitle:"Инструкция к кодам",

    a1:"1) АКТИВАЦИЯ КРИСТАЛЛА ДУШИ",
    a1_p1:"Дыхание с фокусом на Высшем сердце (Тимус). Сложи ладони в «намасте» на уровне груди и сделай вдох из шишковидной железы (аджна), опуская серебристую энергию в точку Высшего сердца. Затем разведи руки перпендикулярно телу на уровне груди и выдохни золотую энергию из Тимуса в мир.",
    a1_p2:"Мысленная формула: «ВДЫХАЮ СВЕТ — ВЫДЫХАЮ ЛЮБОВЬ!». Представляй, как с каждым выдохом вокруг тебя образуется защитное облако золотого света.",
    a1_p3:"Далее со сложенными на груди руками: на вдохе втягивай поток огненной энергии из солнечного сплетения (нижняя сердечная чакра) к Тимусу, а затем на расправленных руках выдыхай в мир золотую энергию.",
    a1_p4:"Мысленная формула: «ВДЫХАЮ СИЛУ — ВЫДЫХАЮ ВОЛЮ!». Также визуализируй золотое защитное облако.",
    a1_p5:"Представь в груди светящийся Кристалл — портал между телом и твоей светоносной копией. Затем простучи точку Тимуса, протяжно звуча «аа».",
    a1_res:(N1,N2,N3)=>`Рекомендации: «Свет–Любовь» — <b>N1 = ${N1}</b> раз; «Сила–Воля» — <b>N2 = ${N2}</b> раз; простукивание — <b>N3 = ${N3}</b> раз.`,

    a2:"2) ЗАПУСК ТОРСИОННОГО ПОЛЯ",
    a2_p1:(T1)=>`Верхняя воронка — вращение по часовой стрелке, руки подняты вверх. <b>T1 = ${T1}</b> раз.`,
    a2_p2:(T2)=>`Нижняя воронка — вращение против часовой стрелки, руки опущены вниз. <b>T2 = ${T2}</b> раз.`,
    a2_p3:(T3)=>`Для гармонизации потоков земной и небесной энергий сложи руки на груди в намасте и выполняй прыжки (или резкий перекат с пятки на носок) <b>T3 = ${T3}</b> раз.`,

    a3:"3) ИНТЕГРАЦИЯ ТЕЛА СВЕТА",
    a3_p1:(C1)=>`Одновременные круги руками вперёд — <b>C1 = ${C1}</b> раз.`,
    a3_p2:(C2)=>`Одновременные круги руками назад — <b>C2 = ${C2}</b> раз.`,
    a3_p3:(C3)=>`Фиксация: ладони в намасте на груди, мягкое надавливание ладонями друг на друга — <b>C3 = ${C3}</b> раз.`,

    tri_t:"Торсионное поле",
    tri_l:"Тело Света",
    tri_s:"Индивидуальная Душа",
  },
  en:{
    reveal:"REVEAL YOUR",
    birthdate:"Birth date",
    language:"Language",
    auto:"Auto",
    calc:"Calculate",
    pdf:"Download PDF",
    vy:v=>`Higher Self Level: ${v}`,
    codesTitle:"Trinity Codes",
    torsion:"Torsion Field Activation",
    light:"Light Body Activation",
    soul:"Individual Soul Activation",
    howtoTitle:"Instructions",

    a1:"1) SOUL CRYSTAL ACTIVATION",
    a1_p1:"Breathing with focus on the Higher Heart (Thymus). Hands in namaste at the chest; inhale from the pineal (ajna), guiding the silvery energy into the Higher Heart point. Then open arms perpendicular to the body at chest level and exhale golden energy from the Thymus into the world.",
    a1_p2:"Mental formula: “I BREATHE IN LIGHT — I BREATHE OUT LOVE!”. Visualize a protective golden cloud forming around you with each exhale.",
    a1_p3:"Next, with palms folded at the chest: inhale a fiery flow from the solar plexus (lower heart chakra) to the Thymus, then exhale golden light with arms open.",
    a1_p4:"Mental formula: “I BREATHE IN POWER — I BREATHE OUT WILL!”. Keep visualizing the golden protective cloud.",
    a1_p5:"Imagine a luminous Crystal in your chest — a portal between the body and your light copy. Then tap the Thymus while sounding “aa”.",
    a1_res:(N1,N2,N3)=>`Recommendations: “Light–Love” — <b>N1 = ${N1}</b> times; “Power–Will” — <b>N2 = ${N2}</b> times; tapping — <b>N3 = ${N3}</b> times.`,

    a2:"2) TORSION FIELD LAUNCH",
    a2_p1:(T1)=>`Upper vortex — clockwise spin, hands up. <b>T1 = ${T1}</b> times.`,
    a2_p2:(T2)=>`Lower vortex — counter-clockwise spin, hands down. <b>T2 = ${T2}</b> times.`,
    a2_p3:(T3)=>`To harmonize the earth and heaven flows: hands in namaste on the chest and gentle jumps (or quick heel-to-toe pulses) <b>T3 = ${T3}</b> times.`,

    a3:"3) LIGHT BODY INTEGRATION",
    a3_p1:(C1)=>`Both hands circles forward — <b>C1 = ${C1}</b> times.`,
    a3_p2:(C2)=>`Both hands circles backward — <b>C2 = ${C2}</b> times.`,
    a3_p3:(C3)=>`Fixation: palms pressing each other in namaste — <b>C3 = ${C3}</b> times.`,

    tri_t:"Torsion Field",
    tri_l:"Light Body",
    tri_s:"Individual Soul",
  }
};
let LANG = 'ru';
const $ = id => document.getElementById(id);

function getAutoLang(){ return (navigator.language||'en').toLowerCase().startsWith('ru')?'ru':'en'; }
function applyTexts(){
  const tr = TR[LANG];
  $('t_reveal').textContent = tr.reveal;
  $('t_birthdate').textContent = tr.birthdate;
  $('t_language').textContent = tr.language;
  $('t_auto').textContent = tr.auto;
  $('btnCalc').textContent = tr.calc;
  $('btnPdf').textContent  = tr.pdf;
  $('codesTitle').textContent = tr.codesTitle;
  $('howtoTitle').textContent = tr.howtoTitle;
}

/* ===== математика ===== */
const sumDigits = n => String(n).split('').reduce((a,b)=>a+ +b,0);
const reduce12  = n => { while(n>12){ n = sumDigits(n); } return n||12; };
const reduce9   = n => { while(n>9){ n = sumDigits(n); } return n; }; // для последних двух цифр года

function buildPositions(iso){
  const [Y,M,D] = iso.split('-').map(Number);
  const P = Array(13).fill(0);
  P[1] = reduce12(D);
  P[2] = reduce12(M);
  P[3] = reduce12(sumDigits(Y));
  P[4] = reduce12(P[1]+P[2]);
  P[5] = reduce12(P[1]+P[3]);
  P[6] = reduce12(P[2]+P[3]);
  P[7] = reduce12(P[4]+P[5]);
  P[8] = reduce12(P[4]+P[6]);
  P[9] = reduce12(P[5]+P[6]);
  P[10]= reduce12(P[7]+P[8]);
  P[11]= reduce12(P[7]+P[9]);
  P[12]= reduce12(P[8]+P[9]);

  // ВЯ: День + Месяц + (век + последние две цифры года, сведённые до 1–9)
  const century = Math.floor(Y/100);       // 19/20
  const yy2     = Y % 100;                 // 69
  const decRed  = reduce9(yy2);            // 69 -> 6 (1+5)
  const VY      = D + M + century + decRed; // 22 + 5 + 19 + 6 = 52
  return {P,VY};
}
const sum12 = (...xs) => reduce12(xs.reduce((a,b)=>a+b,0));

function computeAll(iso){
  const {P,VY} = buildPositions(iso);
  // дыхания
  const N1 = P[5];
  const N2 = P[8];
  const N3 = sum12(P[5],P[8]);

  // меркабы
  const MM = sum12(P[1],P[3],P[5]);       // материальная
  const DM = sum12(P[10],P[8],P[12]);     // духовная
  const T3 = sum12(MM,DM);

  // тело света
  const TOP = sum12(P[7],P[9],P[11]);
  const BOT = sum12(P[2],P[4],P[6]);
  const C3  = sum12(TOP,BOT);

  // инструкции
  const T1 = MM, T2 = DM;  // как мы закрепили ранее
  const C1 = BOT, C2 = TOP;

  // тройки под матрицей:
  // торсионный код: ДМ, ММ, сумма
  const triTorsion = [DM, MM, T3];
  // тело света: верх, низ, сумма
  const triLight   = [TOP, BOT, C3];
  // индивидуальная душа: П5, (П5+П8), П8
  const triSoul    = [P[5], N3, P[8]];

  return {P,VY,N1,N2,N3,T1,T2,T3,C1,C2,C3,triTorsion,triLight,triSoul};
}

/* ===== рендер ===== */
const colorClass = v => 'c'+(v||12);

function renderAll(iso){
  const tr = TR[LANG];
  const d = computeAll(iso);

  // ВЯ
  $('vyBadge').textContent = tr.vy(d.VY);

  // матрица (сверху вниз: 10–12 / 7–9 / 4–6 / 1–3)
  const order = [[10,11,12],[7,8,9],[4,5,6],[1,2,3]];
  let html = '';
  order.forEach(row=>{
    row.forEach(i=>{
      html += `<div class="cell ${colorClass(d.P[i])}"><small>П${i}</small>${d.P[i]}</div>`;
    });
  });
  $('matrix').innerHTML = html;

  // коды
  $('codesBody').innerHTML = `
    <div class="para"><b>${tr.torsion}:</b> <span class="pill">${d.triTorsion.join(', ')}</span></div>
    <div class="para"><b>${tr.light}:</b>   <span class="pill">${d.triLight.join(', ')}</span></div>
    <div class="para"><b>${tr.soul}:</b>    <span class="pill">${d.triSoul.join(', ')}</span></div>
  `;

  // инструкция (полная)
  $('howtoBody').innerHTML = `
    <div class="para"><b>${tr.a1}</b></div>
    <div class="para">${tr.a1_p1}</div>
    <div class="para">${tr.a1_p2}</div>
    <div class="para">${tr.a1_p3}</div>
    <div class="para">${tr.a1_p4}</div>
    <div class="para">${tr.a1_p5}</div>
    <div class="para">${tr.a1_res(d.N1,d.N2,d.N3)}</div>

    <div class="para"><b>${tr.a2}</b></div>
    <div class="para">${tr.a2_p1(d.T1)}</div>
    <div class="para">${tr.a2_p2(d.T2)}</div>
    <div class="para">${tr.a2_p3(d.T3)}</div>

    <div class="para"><b>${tr.a3}</b></div>
    <div class="para">${tr.a3_p1(d.C1)}</div>
    <div class="para">${tr.a3_p2(d.C2)}</div>
    <div class="para">${tr.a3_p3(d.C3)}</div>
  `;
}

/* ===== язык ===== */
function setLang(mode){ // 'auto' | 'ru' | 'en'
  const auto = (mode==='auto') || $('autoLang').checked;
  $('autoLang').checked = auto;
  $('lang').value = auto ? 'auto' : LANG;
  LANG = auto ? getAutoLang() : LANG;
  localStorage.setItem('k_lang_mode', auto ? 'auto' : LANG);
  applyTexts();
  const iso = $('date').value;
  if(iso) renderAll(iso);
}

$('lang').addEventListener('change', ()=>{
  const val = $('lang').value;
  if(val==='auto'){ setLang('auto'); }
  else { LANG = val; setLang(val); }
});
$('autoLang').addEventListener('change', ()=>{
  setLang($('autoLang').checked ? 'auto' : $('lang').value);
});

/* ===== действия ===== */
$('btnCalc').addEventListener('click', ()=>{
  const iso = $('date').value;
  if(!iso){ alert(LANG==='ru'?'Выбери дату рождения':'Pick a birth date'); return; }
  localStorage.setItem('k_date', iso);
  renderAll(iso);
});

$('btnPdf').addEventListener('click', ()=>{
  // PDF можно включить позже снова (у нас он уже был), чтобы не раздувать код.
  alert(LANG==='ru'?'PDF включу после финальной проверки текстов.':'PDF will be enabled after final text check.');
});

/* ===== старт ===== */
(function boot(){
  const savedMode = localStorage.getItem('k_lang_mode');
  if(savedMode===null){
    LANG = getAutoLang();
    setLang('auto'); // по умолчанию авто
  }else{
    if(savedMode==='auto'){ LANG = getAutoLang(); setLang('auto'); }
    else { LANG = savedMode; setLang(savedMode); }
  }
  const savedDate = localStorage.getItem('k_date');
  if(savedDate){ $('date').value = savedDate; renderAll(savedDate); }
})();
</script>
</body>
</html>
