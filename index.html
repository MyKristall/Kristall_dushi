<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>РАСКРОЙ СВОЙ КРИСТАЛЛ ДУШИ</title>
  <style>
    :root{--bg:#0f1220;--panel:#141b3a;--ink:#eaf3ff;--muted:#9fb0d8;--ring:#34406a}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .wrap{max-width:980px;margin:auto;padding:22px}
    h1{margin:8px 0 16px;text-align:center;line-height:1.15;font-weight:800;font-size:clamp(24px,5vw,44px)}
    .glow{color:#ffd966;text-shadow:0 0 6px #ffebb0,0 0 12px #ffd966,0 0 22px #ffcc33}
    .panel{background:#131937;border-radius:16px;padding:16px;margin:14px 0}
    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    .field{display:flex;align-items:center;gap:8px;background:#101735;border:1px solid var(--ring);padding:10px 12px;border-radius:10px}
    .field span{font-size:14px;color:var(--muted)}
    input[type="date"],select,button{background:transparent;border:0;color:var(--ink);font-size:16px}
    button{cursor:pointer;border-radius:12px;padding:12px 16px}
    .primary{background:#2d6ae0;color:#fff}
    .secondary{background:#3b476f;color:#fff}
    .badge{display:inline-block;background:#1a244d;border:1px solid var(--ring);border-radius:999px;padding:8px 14px;margin:8px 0}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;max-width:460px;margin:16px auto}
    .cell{position:relative;border-radius:14px;padding:26px 0;text-align:center;font-weight:900;font-size:26px;color:#00110d;box-shadow:0 8px 20px rgba(0,0,0,.28)}
    .cell small{position:absolute;left:8px;top:6px;font:700 11px/1 system-ui;color:rgba(0,0,0,.65)}
    /* палитра для 1..12 */
    .c1{background:#ff6b6b}.c2{background:#ff994d}.c3{background:#ffd54d}.c4{background:#b8ff6e}
    .c5{background:#24a148;color:#eafff5}.c6{background:#9ee5ff}.c7{background:#5294ff;color:#eef6ff}
    .c8{background:#cfe5ff}.c9{background:#9b6cff;color:#fff}.c10{background:#cba6ff}.c11{background:#ff78c6}.c12{background:#ffc7d7}
    .card{background:#1b2145;border-radius:16px;padding:16px;margin:12px auto;max-width:720px}
    .card h3{margin:0 0 10px;text-align:center}
    .pill{display:inline-block;background:#101735;border:1px solid var(--ring);border-radius:999px;padding:6px 10px;margin:3px 6px;font-weight:700}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 id="title">
      <span id="t_reveal">РАСКРОЙ СВОЙ</span><br>
      <span class="glow">КРИСТАЛЛ ДУШИ</span>
    </h1>

    <div class="panel">
      <div class="controls">
        <label class="field">
          <span id="t_birthdate">Дата рождения</span>
          <input type="date" id="date" />
        </label>
        <label class="field">
          <span id="t_language">Язык</span>
          <select id="lang">
            <option value="ru">Русский</option>
            <option value="en">English</option>
          </select>
        </label>
        <button class="primary" id="btnCalc">Рассчитать</button>
        <button class="secondary" id="btnPdf" title="PDF (опционально)">Скачать PDF</button>
      </div>
    </div>

    <div class="badge" id="vyBadge">—</div>

    <div id="matrix" class="grid"></div>

    <div class="card" id="codes">
      <h3 id="codesTitle">Троичные коды</h3>
      <div id="codesBody"></div>
    </div>

    <div class="card" id="howto">
      <h3 id="howtoTitle">Инструкция к кодам</h3>
      <div id="howtoBody"></div>
    </div>
  </div>

  <script>
    /* ===== i18n ===== */
    let LANG = (localStorage.getItem("k_lang") || (navigator.language||'en').toLowerCase().startsWith('ru') ? 'ru' : 'en');
    const TR = {
      ru: {
        reveal: "РАСКРОЙ СВОЙ",
        birthdate: "Дата рождения",
        language: "Язык",
        calc: "Рассчитать",
        pdf: "Скачать PDF",
        vy: v => `Уровень Высшего Я: ${v}`,
        codesTitle: "Троичные коды",
        torsion: "Активация торсионного поля",
        light: "Активация тела света",
        soul: "Активация индивидуальной души",
        howtoTitle: "Инструкция к кодам",
        a1: "1) АКТИВАЦИЯ КРИСТАЛЛА ДУШИ",
        a1_1: n => `«Вдыхаю Свет — Выдыхаю Любовь». <b>N1 = ${n}</b> раз.`,
        a1_2: n => `«Вдыхаю Силу — Выдыхаю Волю». <b>N2 = ${n}</b> раз.`,
        a1_3: n => `Простукивание точки Тимуса со звуком «аа». <b>N3 = ${n}</b> раз.`,
        a2: "2) ЗАПУСК ТОРСИОННОГО ПОЛЯ",
        a2_1: n => `Верхняя воронка (по часовой, руки вверх). <b>T1 = ${n}</b> раз.`,
        a2_2: n => `Нижняя воронка (против часовой, руки вниз). <b>T2 = ${n}</b> раз.`,
        a2_3: n => `Гармонизация: намасте на груди и лёгкие прыжки (или перекат пятка→носок). <b>T3 = ${n}</b> раз.`,
        a3: "3) ИНТЕГРАЦИЯ ТЕЛА СВЕТА",
        a3_1: n => `Круги руками вперёд. <b>C1 = ${n}</b> раз.`,
        a3_2: n => `Круги руками назад. <b>C2 = ${n}</b> раз.`,
        a3_3: n => `Фиксация: мягкое надавливание ладонями в намасте. <b>C3 = ${n}</b> раз.`
      },
      en: {
        reveal: "REVEAL YOUR",
        birthdate: "Birth date",
        language: "Language",
        calc: "Calculate",
        pdf: "Download PDF",
        vy: v => `Higher Self Level: ${v}`,
        codesTitle: "Triadic Codes",
        torsion: "Torsion Field Activation",
        light: "Light Body Activation",
        soul: "Individual Soul Activation",
        howtoTitle: "Instructions",
        a1: "1) SOUL CRYSTAL ACTIVATION",
        a1_1: n => `“I inhale Light — I exhale Love.” <b>N1 = ${n}</b> times.`,
        a1_2: n => `“I inhale Power — I exhale Will.” <b>N2 = ${n}</b> times.`,
        a1_3: n => `Tap the Thymus, sounding “aa”. <b>N3 = ${n}</b> times.`,
        a2: "2) TORSION FIELD LAUNCH",
        a2_1: n => `Upper vortex (clockwise, hands up). <b>T1 = ${n}</b> times.`,
        a2_2: n => `Lower vortex (counter-clockwise, hands down). <b>T2 = ${n}</b> times.`,
        a2_3: n => `Harmonization: namaste on chest + gentle jumps (or heel→toe pulses). <b>T3 = ${n}</b> times.`,
        a3: "3) LIGHT BODY INTEGRATION",
        a3_1: n => `Simultaneous arm circles forward. <b>C1 = ${n}</b> times.`,
        a3_2: n => `Simultaneous arm circles backward. <b>C2 = ${n}</b> times.`,
        a3_3: n => `Fixation: gentle palms pressing in namaste. <b>C3 = ${n}</b> times.`
      }
    };
    const t = k => TR[LANG][k];

    function applyTexts(){
      document.getElementById('t_reveal').textContent = t('reveal');
      document.getElementById('t_birthdate').textContent = t('birthdate');
      document.getElementById('t_language').textContent = t('language');
      document.getElementById('btnCalc').textContent = t('calc');
      document.getElementById('btnPdf').textContent = t('pdf');
      document.getElementById('codesTitle').textContent = t('codesTitle');
      document.getElementById('howtoTitle').textContent = t('howtoTitle');
    }

    /* ===== математика ===== */
    const sumDigits = n => String(n).split('').reduce((a,b)=>a+ +b,0);
    const reduce12  = n => { while(n>12){ n = sumDigits(n); } return n||12; };

    function buildPositions(iso){
      const [Y,M,D] = iso.split('-').map(Number);
      const P = Array(13).fill(0);
      P[1] = reduce12(D);
      P[2] = reduce12(M);
      P[3] = reduce12(sumDigits(Y));
      P[4] = reduce12(P[1]+P[2]);
      P[5] = reduce12(P[1]+P[3]);
      P[6] = reduce12(P[2]+P[3]);
      P[7] = reduce12(P[4]+P[5]);
      P[8] = reduce12(P[4]+P[6]);
      P[9] = reduce12(P[5]+P[6]);
      P[10]= reduce12(P[7]+P[8]);
      P[11]= reduce12(P[7]+P[9]);
      P[12]= reduce12(P[8]+P[9]);
      // ВЯ: день + месяц + век + десяток года + единица года (без свёртки)
      const century = Math.floor(Y/100);
      const tens    = Math.floor((Y%100)/10);
      const ones    = Y%10;
      const VY = D + M + century + tens + ones;
      return {P,VY};
    }

    // Коды
    const sum12 = (...xs) => reduce12(xs.reduce((a,b)=>a+b,0));
    function computeCodes(P){
      // Дыхания
      const N1 = P[5];                   // «Свет–Любовь»
      const N2 = P[8];                   // «Сила–Воля»
      const N3 = sum12(P[5],P[8]);       // простукивание

      // Торсионное поле
      const T1 = sum12(P[10],P[8],P[12]); // верхняя воронка
      const T2 = sum12(P[1],P[3],P[5]);   // нижняя воронка
      const T3 = sum12(T1,T2);            // гармонизация

      // Тело Света
      const C1 = sum12(P[2],P[4],P[6]);   // вперёд
      const C2 = sum12(P[7],P[9],P[11]);  // назад
      const C3 = sum12(C1,C2);            // фиксация

      // Троичные коды под матрицей (показываем только тройки)
      const triTorsion = [T1,T2,T3];
      const triLight   = [C1,C2,C3];
      const triSoul    = [P[5],P[8],sum12(P[5],P[8])]; // П5, П8, их сумма

      return {N1,N2,N3,T1,T2,T3,C1,C2,C3,triTorsion,triLight,triSoul};
    }

    /* ===== рендер ===== */
    const colorClass = v => 'c'+(v||12);

    function renderAll(iso){
      const {P,VY} = buildPositions(iso);
      const codes = computeCodes(P);

      // ВЯ
      document.getElementById('vyBadge').textContent = t('vy')(VY);

      // Матрица: правильная ориентация (верх: 10–12 → 7–9 → 4–6 → низ: 1–3)
      const order = [[10,11,12],[7,8,9],[4,5,6],[1,2,3]];
      let html = '';
      order.forEach(row=>{
        row.forEach(i=>{
          html += `<div class="cell ${colorClass(P[i])}"><small>П${i}</small>${P[i]}</div>`;
        });
      });
      document.getElementById('matrix').innerHTML = html;

      // Троичные коды (под матрицей — только тройки)
      document.getElementById('codesBody').innerHTML = `
        <div><b>${t('torsion')}:</b> <span class="pill">${codes.triTorsion.join(', ')}</span></div>
        <div><b>${t('light')}:</b>   <span class="pill">${codes.triLight.join(', ')}</span></div>
        <div><b>${t('soul')}:</b>    <span class="pill">${codes.triSoul.join(', ')}</span></div>
      `;

      // Инструкция — только рекомендации + результаты
      document.getElementById('howtoBody').innerHTML = `
        <p><b>${t('a1')}</b><br>
          ${t('a1_1')(codes.N1)}<br>
          ${t('a1_2')(codes.N2)}<br>
          ${t('a1_3')(codes.N3)}
        </p>
        <p><b>${t('a2')}</b><br>
          ${t('a2_1')(codes.T1)}<br>
          ${t('a2_2')(codes.T2)}<br>
          ${t('a2_3')(codes.T3)}
        </p>
        <p><b>${t('a3')}</b><br>
          ${t('a3_1')(codes.C1)}<br>
          ${t('a3_2')(codes.C2)}<br>
          ${t('a3_3')(codes.C3)}
        </p>
      `;
    }

    /* ===== события ===== */
    function applyLang(){
      applyTexts();
      const v = document.getElementById('date').value;
      if(v) renderAll(v);
    }

    document.getElementById('lang').addEventListener('change', e=>{
      LANG = e.target.value;
      localStorage.setItem('k_lang', LANG);
      applyLang();
    });

    document.getElementById('btnCalc').addEventListener('click', ()=>{
      const v = document.getElementById('date').value;
      if(!v){ alert(LANG==='ru'?'Выбери дату':'Pick a date'); return; }
      localStorage.setItem('k_date', v);
      renderAll(v);
    });

    // (PDF можно вернуть позже; кнопка не ломает логику)
    document.getElementById('btnPdf').addEventListener('click', ()=>{
      alert(LANG==='ru'?'Экспорт PDF подключим после финальной проверки расчётов.':'We will enable PDF after final check of calculations.');
    });

    // init
    (function boot(){
      document.getElementById('lang').value = LANG;
      applyTexts();
      const saved = localStorage.getItem('k_date');
      if(saved){ document.getElementById('date').value = saved; renderAll(saved); }
    })();
  </script>
</body>
</html>
